Steps taken to evaluate wolfSSL with the following:

Required Software for this guide:
IAR Embedded Workbench IDE - ARM v7.60.1 (or similar version)
embOS (version that supports your CPU)
wolfssl (latest version)

#----------------------------------------------------------------------------#
# SECTION 1:
# Setting up the file system
#----------------------------------------------------------------------------#

1. Browse to wolfssl/IDE/IAR-EWARM/embOS/
    a. create a new directory called <Your CPU or Company or something unique>
       (For this guide we'll call that directory "CUSTOM_DIR" and we will use
        the term "CUSTOM_DIR" in other directories to signify if a directory
        should be placed inside the new CUSTOM_DIR)

2. create new directory in CUSTOM_DIR "wolfcrypt_lib_CUSTOM_DIR"
3. create new directory in CUSTOM_DIR "wolfcrypt_tests_CUSTOM_DIR"
4. create new directory in CUSTOM_DIR "CUSTOM_DIR_user_settings"
5. Copy C:<path to>\wolfssl\IDE\IAR-EWARM/embOS\SAMV71_XULT\
                                embOS_SAMV71_XULT_user_settings\user_settings.h
   paste that into the new CUSTOM_DIR\CUSTOM_DIR_user_settings\

#----------------------------------------------------------------------------#
# SECTION 2:
# Create wolfcrypt_lib.a
#----------------------------------------------------------------------------#

1. Open IAR Workbench -> Project -> Create New Project -> Empty Project
    c. Browse to CUSTOM_DIR/wolfcrypt_lib_CUSTOM_DIR/ (from section 1)
    d. Called it "wolfcrypt_lib" and hit "Save"

2. Go to Project -> Add Group...
    a. call group wolfcrypt_sources

3. Right click on wolfcrypt_sources group -> Add -> Add Files...

4. Browse to wolfssl/wolfcrypt/src directory and select the following files:

 #---------------------------------------------#
 #     aes.c                   memory.c        #
 #     asn.c                   misc.c          #
 #     chacha.c                poly1305.c      #
 #     chacha20_poly1305.c     pwdbased.c      #
 #     coding.c                rabbit.c        #
 #     des3.c                  random.c        #
 #     dh.c                    rsa.c           #
 #     dsa.c                   sha.c           #
 #     ecc.c                   sha256.c        #
 #     hash.c                  sha512.c        #
 #     hmac.c                  tfm.c           #
 #     md4.c                   wc_encrypt.c    #
 #     md5.c                   wc_port.c       #
 #---------------------------------------------#

5. Once those are all added go to
                    Project -> Properties C/C++ Compiler -> Preprocessor (Tab)
    a. In the field "Defined symbols:" add WOLFSSL_USER_SETTINGS
    b. In the field "Additional include directories:"
        Click the box with "..."
        Click <Click to add>
        Browse to "wolfssl" directory on your PC and click "Select" then "Ok"
        You should now see "C:\<path to>\wolfssl" in that field
        Click <Click to add> again
        Browse to "wolfssl\IDE\IAR-EWARM\CUSTOM_DIR\CUSTOM_DIR_user_settings\"
        Hit "Ok", verify the path is correct and hit "Ok" again.

    (Remember we copy and pasted this over in section 1. If you ever need to
     change or customize your build settings this is the file that should be
     modified: CUSTOM_DIR\CUSTOM_DIR_user_settings\user_settings.h)

7. In Project -> Options -> General Options -> Output (Tab)
    Check the option for "Library" instead of "Executable"
    Click "OK"

8. Go to Project -> Rebuild all (The library should build)

9. Confirm the library is now located here:
    C:\<path to>\wolfssl\IDE\IAR-EWARM\wolfcrypt_build_lib\Debug\Exe\
                                                                wolfcrypt_lib.a

We are now set to link to this library in the evaluation project

#----------------------------------------------------------------------------#
# Evaluate in embOS project:
#----------------------------------------------------------------------------#


1. go to embOS website and download a trial for your platform
   https://www.segger.com/downloads/embos ->
                                      embOS trial for Cortex-M and IAR compiler

2. After download and unzipping open IAR Workbench
    a. choose Project -> Add Existing Project
    b. Navigate to the downloaded trial then:
       Start\BoardSupport\<VENDOR>\<CPU>\Start_<CPU>.ewp
      (For example) Start\BoardSupport\Atmel\SAMV71_XPlainedUltra\Start_SAMv71.ewp

3. Go to Project -> Options -> C/C++ Compiler -> Preprocessor (Tab)
    a. Add this to the "Defined symbols: (one per line)" Box:
        WOLFSSL_USER_SETTINGS
    b. Now in the above box "Additional include directories:"
        Click on the box with "..."
        Click <Click to add>
        Browse to "wolfssl" directory on your computer and click "Select"
    c.  This project will use the same user_settings.h as in the above project
        where we built the library so both have the exact same settings

4. Go to Project -> Options -> Linker -> Library (Tab)
    Next to the field "Additonal libraries: (one per line)"
    Click the box with "..."
    Click <Click to add>
    Browse to C:\<path to>\CUSTOM_DIR\wolfcrypt_lib_CUSTOM_DIR\Debug\Exe\wolfcrypt_lib.a
    Click "Open" and "OK" (twice)

5. In the main project file "OS_StartLEDBlick.c"

    #--- Headers ---#
        #include <stdio.h>
        #include <wolfcrypt/test/test.h>

    #--- Task for wolfCrypt ---#
        static OS_STACKPTR int StackWOLF[20000];
        static OS_TASK TCWOLF;
        static void wolfTestRun(void) {
            printf("Begin wolfcrypt tests\n");
            wolfcrypt_test(NULL);
            printf("Wolfcrypt tests complete\n");
        }

    #--- Create the task in main() BEFORE calling OS_Start() ---#
        OS_CREATETASK(&TCWOLF, "wolfcrypt test Task", wolfTestRun, 100, StackWOLF);

6. To get Logging working for seeing test results:
    a. Go to Project -> Options -> General Options -> Library Configuration (Tab)
    b. In the field "Library low-level interface implementation"
        Check the radio button for Semihosted
        Then in the inner field marked "stdout/stderr"
            Check the radio button for "Via semihosting" and click "OK"

7. Now we're ready to build and debug the project.
    a. Project -> Options -> Debugger
        In the field marked "Driver" Select drop-down and choose J-Link/J-Trace
        Click "OK"
    b. Project -> Rebuild All
    c. Connect your Cortex-M evaluation board to j-Trace and j-Trace to PC
    d. Connect the micro-USB to the debug port of the Cortex-M and PC for power
    e. Project -> Download and Debug

8. Once the Debug environment spawns go to View -> Terminal I/O
    This is where the "printf" to stdout will be directed

9. In the Debug Menu bar look for the little square with three arrows pointing
    to the right. When you mouse over it should say "GO"
    Click this option and in the Terminal I/O Window you should see something
    like this (depends on which functionality you set in user_settings.h)

    SEE NOTE 1 BELOW IF YOU OBSERVE AN ERROR (-40) IN RSA TEST

Begin wolfcrypt tests
MD5      test passed!
MD4      test passed!
SHA      test passed!
SHA-256  test passed!
SHA-384  test passed!
SHA-512  test passed!
HMAC-MD5 test passed!
HMAC-SHA test passed!
HMAC-SHA256 test passed!
HMAC-SHA384 test passed!
HMAC-SHA512 test passed!
GMAC     test passed!
HC-128   test passed!
Rabbit   test passed!
Chacha   test passed!
POLY1305 test passed!
ChaCha20-Poly1305 AEAD test passed!
DES      test passed!
DES3     test passed!
AES      test passed!
AES-GCM  test passed!
RANDOM   test passed!
RSA      test passed!
DH       test passed!
DSA      test passed!
PWDBASED test passed!
ECC      test passed!

total   Allocs =       988
total   Bytes  =   1471829
peak    Bytes  =     29576
current Bytes  =         0

Thank you for using this guide and we hope this was helpful to you. If you have
any suggestions / feedback for us please contact us:
support@wolfssl.com
info@wolfssl.com

/* --------------------------------------------------------------------------*/
#### NOTE 1: ####

If you are working off of a base example project and you observe memory errors
when malloc is called, make sure that the linker script has set the HEAP high
enough.
Project -> Options -> Linker -> (Config Tab) -> Linker configuration file

Check this file for __size_heap__ it is typically set to 0x200 by default.
There are places in wolfSSL that malloc as much as 4k at a time and peak usage
can be as high as 29K if using full functionality.
/* --------------------------------------------------------------------------*/

Copyright Â© 2016 wolfSSL Inc.  All rights reserved.

